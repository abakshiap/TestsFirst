SELECT *
FROM tests
WHERE
  -- Framework from selected session
  (
    {{ !get_session_details.data[0]?.framework || "true" }}
    OR framework = '{{ get_session_details.data[0]?.framework }}'
  )

  -- Area filter (MultiSelect)
  AND (
    {{ areaFilter.selectedOptionValues.length === 0
        ? "true"
        : "area = ANY ('{" + areaFilter.selectedOptionValues.join(",") + "}'::text[])" }}
  )

  -- Tool filter (MultiSelect)
  AND (
    {{ toolFilter.selectedOptionValues.length === 0
        ? "true"
        : "EXISTS (SELECT 1 FROM unnest(tool_tags) AS tag WHERE tag = ANY ('{" + toolFilter.selectedOptionValues.join(",") + "}'::text[]))" }}
  );